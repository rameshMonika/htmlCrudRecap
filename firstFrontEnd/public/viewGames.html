<!DOCTYPE html>

<html lang="en">

<head>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SP Games</title>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
 
</head>

<body data-new-gr-c-s-check-loaded="14.991.0" data-gr-ext-installed="">
    <div class="container">
    </div>

    
    <script src="./viewUser_files/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="./viewUser_files/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="./viewUser_files/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script>

     
        
        function createCard(cardInfo) {
            console.log(cardInfo);

           


            var card = `
            <div class="col-sm-8">
    <div class="card text-white bg-secondary border-info" style="margin-top: 2rem;">
                    <div class="card-body">
                        <p class="card-text text-white">${cardInfo.title}</p>
                    </div>
                    <div class="card-footer ">
                        ${cardInfo.description}
                    </div>
                    <div class="card-footer text-muted">
                        <a href="/viewGame.html?gameid=${cardInfo.gameid}"
                            class="btn btn-primary">View</a>

                    </div>
                </div>
                </div>`;
      
            
            return card;
        }

        
        function loadAllGames() {
            // $.ajax({
            //     // headers: { 'authorization': 'Bearer ' + tmpToken },
            //     url: 'http://localhost:8000/games/',
            //     type: 'GET',
            //     // data: JSON.stringify(data2),
            //     contentType: "application/json; charset=utf-8",
            //     // dataType: 'json',
            //     success: function (data, textStatus, xhr) {
            //         console.log("-------response data------")
            //         console.log(data)
            //         console.log("LENGTH OF DATA:"+data.length)

            //         for (var i = 0; i < data.length; i++) {
            //             var game = data[i];
            //             // console.log("game:"+game.gameid);
            //             // console.log("title:"+game.title);
            //             // console.log("email:"+user.email);


            //             var cardInfo = {
            //                 "gameid": game.gameid,
            //                 "title": game.title,
            //                 "description": game.description,
            //                 "price": game.price,
            //                 "platform": game.platform,
            //                 "categoryid": game.categoryid,
            //             }

            //             console.log("---------Card INfo data pack------------")
            //             console.log(cardInfo);

            //             var newCard = createCard(cardInfo);

            //             $('#users').append(newCard);


            //         }




            //         // if (data != null && data.success) {


            //         //     $('#msg').html('Record updated successfully!');

            //         // } else {
            //         //     console.log("Error");
            //         // }
            //     },
            //     error: function (xhr, textStatus, errorThrown) {
            //         console.log('Error in Operation');

            //         console.log(xhr);
            //         console.log(textStatus);
            //         console.log(errorThrown);

            //         console.log(xhr.responseText);
            //         console.log(xhr.status);

            //         // if (xhr.status == 401) {
            //         //     $('#msg').html("yo! Unauthorized!")
            //         // }
            //     }
            // });



            axios.get(`http://localhost:8000/games/`)
                    .then(response => {
                        // $('#msg').html('User added successfully!');

                        console.log("responseeeeeeeeeee")
                        console.log(response.data);
                        console.log("LENGTH OF DATA:"+response.data.length)

                        for (var i = 0; i < response.data.length; i++) {
                        var game = response.data[i];
                        // console.log("game:"+game.gameid);
                        // console.log("title:"+game.title);
                        // console.log("email:"+user.email);


                        var cardInfo = {
                            "gameid": game.gameid,
                            "title": game.title,
                            "description": game.description,
                            "price": game.price,
                            "platform": game.platform,
                            "categoryid": game.categoryid,
                        }

                        console.log("---------Card INfo data pack------------")
                        console.log(cardInfo);

                        var newCard = createCard(cardInfo);

                        $('#users').append(newCard);


                    }

                        
                    })
                    .catch(error => {
                        // if (error) {
                            console.log(error);
                            $('#msg').html('Account with this email already exists');
                        // }
                        
                        

                    })
            
            







        }


        function loadGame(searchGamePlatform,searchGamePrice,searchGameTitle) {
            $.ajax({

               
                url: `http://localhost:8000/games/Maxprice/${searchGamePrice}/titlename/${searchGameTitle}/platform/${searchGamePlatform}`,
                type: 'GET',
             
                dataType: 'json',
                success: function (data, textStatus, xhr) {
                    console.log("-------response data------")
                    console.log(data)
                    var datal=data.length;
                    console.log("========num of data=========")
                    console.log(datal);

                    


                    if (data.length == 0) {
                        console.log("No user found in Search")
                        $('#messages').html("No user found in Search")
                        loadAllGames();
                        return;
                    }

                    
                    for (var i = 0; i < data.length; i++) {
                        var game = data[i];
                       

                        var cardInfo = {
                            "gameid": game.gameid,
                            "title": game.title,
                            "description": game.description,
                            "price": game.price,
                            "platform": game.platform,
                            "categoryid": game.categoryid,
                        }

                        console.log("---------Card INfo data pack------------")
                        console.log(cardInfo);

                        var newCard = createCard(cardInfo);

                        $('#users').append(newCard);


                    }




                },
                error: function (xhr, textStatus, errorThrown) {
                    console.log('Error in Operation');

                    console.log(xhr);
                    console.log(textStatus);
                    console.log(errorThrown);

                    console.log(xhr.responseText);
                    console.log(xhr.status);

                 
                }
            });


        }


        $(document).ready(function () {
        

            var queryParams = new URLSearchParams(window.location.search);
            console.log("--------Query Params----------")
            console.log("Query Param (source): " + window.location.search)
            console.log("Query Param (extraction): " + queryParams)

            // if (queryParams.has("search_gameplatform")&&queryParams.has("search_gameprice")&&queryParams.has("search_gametitle")) {
             
            //     var platform = queryParams.get("search_gameplatform")
            //     var price = queryParams.get("search_gameprice")
            //     var title = queryParams.get("search_gametitle")
             
            //     console.log(platform);
            //     console.log(price);
            //     console.log(title);
            //     loadGame(platform,price,title);
            // }
            // else {
            

                loadAllGames();

            // }





            // $('#Search').click(function () {

            //     console.log("search button is clicked")

              

            //     var searchGamePlatform = $('#GamePlatform').val();
           


            //     console.log("Search Platform: " + searchGamePlatform)

            //     var searchGamePrice = $('#GamePrice').val();

            //     if(searchGamePrice==""){
            //         searchGamePrice=30000
            //     }
            //     else if(searchGamePrice!=""){
            //         searchGamePrice=searchGamePrice
            //     }

            //     console.log("search GamePrice" + searchGamePrice)

            //     var searchGameTitle = $('#GameTitle').val();


            //     console.log("Search GameTitle: " + searchGameTitle)

  

         
            //     var redirectURL = `http://localhost:8001/viewGames.html?search_gameplatform=${searchGamePlatform}&search_gameprice=${searchGamePrice}&search_gametitle=${searchGameTitle}`;

               
            //     window.location.assign(redirectURL)
            //     console.log("Redirect URL: " + redirectURL)

            //     return false

            // })





        });  
   
   
   
   </script>



    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="#">SpGames</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <div class="navbar-nav">
                <a class="nav-item nav-link " href="http://localhost:8001/login.html">Home </a>
                <a class="nav-item nav-link active" href="http://localhost:8001/viewGames.html">Games<span class="sr-only">(current)</span></a>
                <a class="nav-item nav-link" href="http://localhost:8001/about.html">About</a>
             
              </div>
            </div>
          </nav>

        <div style="margin-top: 2rem;">
            <h1>Home</h1>
            
            <div id="messages">

            </div>
<!-- 
            <form id="search-user-form" style="margin-top: 2rem;">
                <div class="form-group">
                    <textarea class="form-control" id="GamePlatform" rows="2" placeholder="Search which platform?"></textarea>
                </div>
                <div class="form-group">
                    <textarea class="form-control" id="GamePrice" rows="3" placeholder="Price of game?"></textarea>
                </div>
                <div class="form-group">
                    <textarea class="form-control" id="GameTitle" rows="3" placeholder="Title of game?"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" id="Search">Search Game</button>
            </form> -->

           

            <div id="users">


            </div>
        </div>
    </div>





</body>

</html>